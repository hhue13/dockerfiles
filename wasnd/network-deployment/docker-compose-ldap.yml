version: '2'

networks:
  cellNetwork:
    driver: bridge

services:
  ldap1:
    # docker run --env LDAP_ORGANISATION="2i" --env LDAP_DOMAIN="2i.at" --env LDAP_ADMIN_PASSWORD="admin" --detach --name ldap    osixia/openldap:1.1.7
    image: osixia/openldap:1.1.7
    container_name: ldap1
    hostname: ldap1
    environment:
      LDAP_ORGANISATION: ALTES_LDAP
      LDAP_DOMAIN: alt.at
      LDAP_ADMIN_PASSWORD: admin
    expose:
      - "389"
      - "636"
    ports:
      - "389:389"
      - "636:636"
    volumes:
      - $PRJ_ROOT/wasconfig:/wasconfig:rw
      - $PRJ_ROOT/was_configs:/config:rw
    networks:
      - cellNetwork

  ldap2:
    # docker run --env LDAP_ORGANISATION="2i" --env LDAP_DOMAIN="2i.at" --env LDAP_ADMIN_PASSWORD="admin" --detach --name ldap    osixia/openldap:1.1.7
    image: osixia/openldap:1.1.7
    container_name: ldap2
    hostname: ldap2
    environment:
      LDAP_ORGANISATION: NEUES_LDAP
      LDAP_DOMAIN: neu.at
      LDAP_ADMIN_PASSWORD: admin
    expose:
      - "389"
      - "636"
    ports:
      - "10389:389"
      - "10636:636"
    volumes:
      - $PRJ_ROOT/wasconfig:/wasconfig:rw
      - $PRJ_ROOT/was_configs:/config:rw
    networks:
      - cellNetwork

  dmgr:
    image: wasnd-cell-dmgr
    container_name: dmgr
    depends_on:
      - ldap1
      - ldap2
    environment:
      DUMMY: test
    hostname: dmgr
    expose:
      - "9060"
      - "9043"
      - "9809"
      - "8879"
      - "9632"
      - "9401"
      - "9403"
      - "9402"
      - "9100"
      - "7277"
      - "9352"
      - "5555"
      - "7060"
      - "11005"
      - "11006"
      - "9420"
    ports:
      - "9060:9060"
      - "9043:9043"
    volumes:
      - $PRJ_ROOT/wasconfig:/wasconfig:rw
      - $PRJ_ROOT/was_configs:/config:rw
    networks:
      - cellNetwork

  node01:
    image: wasnd-cell-node01
    container_name: node01
    depends_on:
      - dmgr
    environment:
      NODE_NAME: CustomNode01
      DMGR_HOST: dmgr
      DMGR_PORT: "8879"
    hostname: node01
    expose:
      - 2809
      - 9402
      - 9403
      - 9353
      - 9633
      - 9100
      - 11004
      - 11003
      - 9401
      - 7276
      - 7286
      - 5558
      - 5578
      - 5060
      - 5061
      - 8880
      - 9060
      - 9043
      - 9080
      - 9443
    ports:
      - "9080:9080"
      - "9443:9443"
    networks:
      - cellNetwork

  node02:
    image: wasnd-cell-node02
    container_name: node02
    depends_on:
      - dmgr
    environment:
      NODE_NAME: CustomNode02
      DMGR_HOST: dmgr
      DMGR_PORT: "8879"
    hostname: node02
    expose:
      - 2809
      - 9402
      - 9403
      - 9353
      - 9633
      - 9100
      - 11004
      - 11003
      - 9401
      - 7276
      - 7286
      - 5558
      - 5578
      - 5060
      - 5061
      - 8880
      - 9060
      - 9043
      - 9080
      - 9443
    networks:
      - cellNetwork
